<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generate Stan Code for Diagnostic Classification Models • dcmstan</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Open_Sans-0.4.10/font.css" rel="stylesheet">
<link href="deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="deps/Playfair_Display-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Generate Stan Code for Diagnostic Classification Models">
<meta name="description" content="Diagnostic classification models are psychometric models used to categorically estimate respondents mastery, or proficiency, on a set of predefined skills (Bradshaw, 2016, &lt;doi:10.1002/9781118956588.ch13&gt;). Diagnostic models can be estimated with Stan; however, the necessary scripts can be long and complicated. This package automates the creation of Stan scripts for diagnostic classification models. Specify different types of diagnostic models, define prior distributions, and automatically generate the necessary Stan code for estimating the model.">
<meta property="og:description" content="Diagnostic classification models are psychometric models used to categorically estimate respondents mastery, or proficiency, on a set of predefined skills (Bradshaw, 2016, &lt;doi:10.1002/9781118956588.ch13&gt;). Diagnostic models can be estimated with Stan; however, the necessary scripts can be long and complicated. This package automates the creation of Stan scripts for diagnostic classification models. Specify different types of diagnostic models, define prior distributions, and automatically generate the necessary Stan code for estimating the model.">
<meta property="og:image" content="https://dcmstan.r-dcm.org/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">dcmstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/dcmstan.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/attribute-hierarchies.html">Specifying attribute hierarchies</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dcm/dcmstan/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="dcmstan-">dcmstan 
<a class="anchor" aria-label="anchor" href="#dcmstan-"></a>
</h1>
</div>
<!-- badges: start -->

<p>dcmstan provides functionality to automatically generate <a href="https://mc-stan.org" class="external-link"><em>Stan</em></a> code for estimating diagnostic classification models. Using dcmstan, you can:</p>
<ul>
<li>Mix and match different <a href="https://dcmstan.r-dcm.org/reference/measurement-model">measurement</a> and <a href="https://dcmstan.r-dcm.org/reference/structural-model">structural</a> models to specify a diagnostic model with <code><a href="reference/dcm_specify.html">dcm_specify()</a></code>,</li>
<li>Define <code><a href="reference/prior.html">prior()</a></code> distributions, and</li>
<li>Generate Stan code for the model, given the specifications and priors with <code><a href="reference/stan_code.html">stan_code()</a></code>
</li>
</ul>
<p>dcmstan is used as a backend for generating the Stan code needed to estimate and evaluate with the <a href="https://measr.info" class="external-link">measr</a> package. If you use measr to estimate your models, you will not need to use dcmstan to generate Stan code yourself.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of dcmstan from <a href="https://cran.r-project.org/" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dcmstan"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"r-dcm/dcmstan"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>We can create a specification for a diagnostic model using <code><a href="reference/dcm_specify.html">dcm_specify()</a></code>, which requires a Q-matrix, the name of the item identifier column in the Q-matrix (optional), and the choice of measurement and structural models.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcmstan.r-dcm.org">dcmstan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcmdata.r-dcm.org" class="external-link">dcmdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dcm_specify.html">dcm_specify</a></span><span class="op">(</span></span>
<span>  qmatrix <span class="op">=</span> <span class="va">mdm_qmatrix</span>,</span>
<span>  identifier <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  measurement_model <span class="op">=</span> <span class="fu"><a href="reference/measurement-model.html">lcdm</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  structural_model <span class="op">=</span> <span class="fu"><a href="reference/structural-model.html">unconstrained</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_model</span></span>
<span><span class="co">#&gt; A loglinear cognitive diagnostic model (LCDM) measuring 1 attributes with 4</span></span>
<span><span class="co">#&gt; items.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Attributes:</span></span>
<span><span class="co">#&gt; • "multiplication" (4 items)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Attribute structure:</span></span>
<span><span class="co">#&gt;   Unconstrained</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Prior distributions:</span></span>
<span><span class="co">#&gt;   intercept ~ normal(0, 2)</span></span>
<span><span class="co">#&gt;   maineffect ~ lognormal(0, 1)</span></span>
<span><span class="co">#&gt;   `Vc` ~ dirichlet(1)</span></span></code></pre></div>
<p>We can then generate the <em>Stan</em> code and data list required for estimating the model with <a href="https://mc-stan.org/rstan/" class="external-link">rstan</a> or <a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stan_code.html">stan_code</a></span><span class="op">(</span><span class="va">new_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; data {</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; I;                      // number of items</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; R;                      // number of respondents</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; N;                      // number of observations</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; C;                      // number of classes</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=1,upper=I&gt; ii;    // item for observation n</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=1,upper=R&gt; rr;    // respondent for observation n</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=0,upper=1&gt; y;     // score for observation n</span></span>
<span><span class="co">#&gt;   array[R] int&lt;lower=1,upper=N&gt; start; // starting row for respondent R</span></span>
<span><span class="co">#&gt;   array[R] int&lt;lower=1,upper=I&gt; num;   // number items for respondent R</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; parameters {</span></span>
<span><span class="co">#&gt;   simplex[C] Vc;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// item intercepts</span></span>
<span><span class="co">#&gt;   real l1_0;</span></span>
<span><span class="co">#&gt;   real l2_0;</span></span>
<span><span class="co">#&gt;   real l3_0;</span></span>
<span><span class="co">#&gt;   real l4_0;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// item main effects</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; l1_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; l2_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; l3_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; l4_11;</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; transformed parameters {</span></span>
<span><span class="co">#&gt;   vector[C] log_Vc = log(Vc);</span></span>
<span><span class="co">#&gt;   matrix[I,C] pi;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// probability of correct response</span></span>
<span><span class="co">#&gt;   pi[1,1] = inv_logit(l1_0);</span></span>
<span><span class="co">#&gt;   pi[1,2] = inv_logit(l1_0+l1_11);</span></span>
<span><span class="co">#&gt;   pi[2,1] = inv_logit(l2_0);</span></span>
<span><span class="co">#&gt;   pi[2,2] = inv_logit(l2_0+l2_11);</span></span>
<span><span class="co">#&gt;   pi[3,1] = inv_logit(l3_0);</span></span>
<span><span class="co">#&gt;   pi[3,2] = inv_logit(l3_0+l3_11);</span></span>
<span><span class="co">#&gt;   pi[4,1] = inv_logit(l4_0);</span></span>
<span><span class="co">#&gt;   pi[4,2] = inv_logit(l4_0+l4_11);</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; model {</span></span>
<span><span class="co">#&gt;   ////////////////////////////////// priors</span></span>
<span><span class="co">#&gt;   Vc ~ dirichlet(rep_vector(1, C));</span></span>
<span><span class="co">#&gt;   l1_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   l1_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   l2_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   l2_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   l3_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   l3_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   l4_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   l4_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// likelihood</span></span>
<span><span class="co">#&gt;   for (r in 1:R) {</span></span>
<span><span class="co">#&gt;     row_vector[C] ps;</span></span>
<span><span class="co">#&gt;     for (c in 1:C) {</span></span>
<span><span class="co">#&gt;       array[num[r]] real log_items;</span></span>
<span><span class="co">#&gt;       for (m in 1:num[r]) {</span></span>
<span><span class="co">#&gt;         int i = ii[start[r] + m - 1];</span></span>
<span><span class="co">#&gt;         log_items[m] = y[start[r] + m - 1] * log(pi[i,c]) +</span></span>
<span><span class="co">#&gt;                        (1 - y[start[r] + m - 1]) * log(1 - pi[i,c]);</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;       ps[c] = log_Vc[c] + sum(log_items);</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     target += log_sum_exp(ps);</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu"><a href="reference/stan_data.html">stan_data</a></span><span class="op">(</span><span class="va">new_model</span>, data <span class="op">=</span> <span class="va">mdm_data</span>, identifier <span class="op">=</span> <span class="st">"respondent"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 9</span></span>
<span><span class="co">#&gt;  $ I    : int 4</span></span>
<span><span class="co">#&gt;  $ R    : int 142</span></span>
<span><span class="co">#&gt;  $ N    : int 568</span></span>
<span><span class="co">#&gt;  $ C    : int 2</span></span>
<span><span class="co">#&gt;  $ ii   : num [1:568] 1 2 3 4 1 2 3 4 1 2 ...</span></span>
<span><span class="co">#&gt;  $ rr   : num [1:568] 1 1 1 1 2 2 2 2 3 3 ...</span></span>
<span><span class="co">#&gt;  $ y    : int [1:568] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ start: int [1:142] 1 5 9 13 17 21 25 29 33 37 ...</span></span>
<span><span class="co">#&gt;  $ num  : int [1:142] 4 4 4 4 4 4 4 4 4 4 ...</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="contributions-and-code-of-conduct">Contributions and Code of Conduct<a class="anchor" aria-label="anchor" href="#contributions-and-code-of-conduct"></a>
</h2>
<p>Contributions are welcome. To ensure a smooth process, please review the <a href="https://dcmstan.r-dcm.org/CONTRIBUTING.html">Contributing Guide</a>. Please note that the dcmstan project is released with a <a href="https://dcmstan.r-dcm.org/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=dcmstan" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-dcm/dcmstan/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-dcm/dcmstan/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dcmstan</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://wjakethompson.com" class="external-link">W. Jake Thompson</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7339-0300" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Jeffrey Hoover <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-0276-0308" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Auburn Jimenez <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-7072-2960" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://wjakethompson.com" class="external-link">W. Jake Thompson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
