<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate 'Stan' code for a diagnostic classification models — stan_code • dcmstan</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Playfair_Display-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate 'Stan' code for a diagnostic classification models — stan_code"><meta name="description" content="Given a specification for a diagnostic classification model or a generated
quantities definition, automatically generate the 'Stan' code necessary to
estimate the model. For details on how the code blocks relate to diagnostic
models, see da Silva et al. (2017), Jiang and Carter (2019),
and Thompson (2019)."><meta property="og:description" content="Given a specification for a diagnostic classification model or a generated
quantities definition, automatically generate the 'Stan' code necessary to
estimate the model. For details on how the code blocks relate to diagnostic
models, see da Silva et al. (2017), Jiang and Carter (2019),
and Thompson (2019)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dcmstan</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dcm/dcmstan/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate 'Stan' code for a diagnostic classification models</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-dcm/dcmstan/blob/main/R/zzz-methods-stan-code.R" class="external-link"><code>R/zzz-methods-stan-code.R</code></a></small>
      <div class="d-none name"><code>stan_code.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a specification for a diagnostic classification model or a generated
quantities definition, automatically generate the 'Stan' code necessary to
estimate the model. For details on how the code blocks relate to diagnostic
models, see da Silva et al. (2017), Jiang and Carter (2019),
and Thompson (2019).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_code</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <a href="dcm_specify.html">model specification</a> or
<a href="generated-quantities.html">generated quantities</a> object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="https://glue.tidyverse.org/reference/as_glue.html" class="external-link">glue</a> object containing the 'Stan' code for the
specified model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>da Silva, M. A., de Oliveira, E. S. B., von Davier, A. A., and
Bazán, J. L. (2017). Estimating the DINA model parameters using the
No-U-Turn sampler. <em>Biometrical Journal, 60</em>(2), 352-368.
<a href="https://doi.org/10.1002/bimj.201600225" class="external-link">doi:10.1002/bimj.201600225</a></p>
<p>Jiang, Z., &amp; Carter, R. (2019). Using Hamiltonian Monte Carlo to
estimate the log-linear cognitive diagnosis model via Stan. <em>Behavior
Research Methods, 51</em>, 651-662. <a href="https://doi.org/10.3758/s13428-018-1069-9" class="external-link">doi:10.3758/s13428-018-1069-9</a></p>
<p>Thompson, W. J. (2019). <em>Bayesian psychometrics for diagnostic
assessments: A proof of concept</em> (Research Report No. 19-01). University of
Kansas; Accessible Teaching, Learning, and Assessment Systems.
<a href="https://doi.org/10.35542/osf.io/jzqs8" class="external-link">doi:10.35542/osf.io/jzqs8</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">qmatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  att1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  att2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="dcm_specify.html">dcm_specify</a></span><span class="op">(</span>qmatrix <span class="op">=</span> <span class="va">qmatrix</span>,</span></span>
<span class="r-in"><span>                          measurement_model <span class="op">=</span> <span class="fu"><a href="measurement-model.html">lcdm</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          structural_model <span class="op">=</span> <span class="fu"><a href="structural-model.html">unconstrained</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">stan_code</span><span class="op">(</span><span class="va">model_spec</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; I;                      // number of items</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; R;                      // number of respondents</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; N;                      // number of observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   int&lt;lower=1&gt; C;                      // number of classes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int&lt;lower=1,upper=I&gt; ii;    // item for observation n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int&lt;lower=1,upper=R&gt; rr;    // respondent for observation n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[N] int&lt;lower=0,upper=1&gt; y;     // score for observation n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[R] int&lt;lower=1,upper=N&gt; start; // starting row for respondent R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   array[R] int&lt;lower=1,upper=I&gt; num;   // number items for respondent R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   simplex[C] Vc;                  // base rates of class membership</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// item intercepts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real l1_0;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real l2_0;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real l3_0;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real l4_0;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real l5_0;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// item main effects</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l1_11;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l1_12;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l2_11;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l3_12;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l4_11;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=0&gt; l5_12;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// item interactions</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   real&lt;lower=-1 * min([l1_11,l1_12])&gt; l1_212;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> transformed parameters {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vector[C] log_Vc = log(Vc);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   matrix[I,C] pi;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// probability of correct response</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[1,1] = inv_logit(l1_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[1,2] = inv_logit(l1_0+l1_11);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[1,3] = inv_logit(l1_0+l1_12);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[1,4] = inv_logit(l1_0+l1_11+l1_12+l1_212);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[2,1] = inv_logit(l2_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[2,2] = inv_logit(l2_0+l2_11);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[2,3] = inv_logit(l2_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[2,4] = inv_logit(l2_0+l2_11);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[3,1] = inv_logit(l3_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[3,2] = inv_logit(l3_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[3,3] = inv_logit(l3_0+l3_12);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[3,4] = inv_logit(l3_0+l3_12);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[4,1] = inv_logit(l4_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[4,2] = inv_logit(l4_0+l4_11);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[4,3] = inv_logit(l4_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[4,4] = inv_logit(l4_0+l4_11);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[5,1] = inv_logit(l5_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[5,2] = inv_logit(l5_0);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[5,3] = inv_logit(l5_0+l5_12);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pi[5,4] = inv_logit(l5_0+l5_12);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// priors</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Vc ~ dirichlet(rep_vector(1, C));</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l1_0 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l1_11 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l1_12 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l1_212 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l2_0 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l2_11 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l3_0 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l3_12 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l4_0 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l4_11 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l5_0 ~ normal(0, 2);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   l5_12 ~ lognormal(0, 1);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ////////////////////////////////// likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   for (r in 1:R) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     row_vector[C] ps;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (c in 1:C) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       array[num[r]] real log_items;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       for (m in 1:num[r]) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         int i = ii[start[r] + m - 1];</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         log_items[m] = y[start[r] + m - 1] * log(pi[i,c]) +</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        (1 - y[start[r] + m - 1]) * log(1 - pi[i,c]);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       ps[c] = log_Vc[c] + sum(log_items);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     target += log_sum_exp(ps);</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://wjakethompson.com" class="external-link">W. Jake Thompson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

