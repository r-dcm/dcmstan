<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to dcmstan • dcmstan</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Playfair_Display-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to dcmstan">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dcmstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/dcmstan.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/attribute-hierarchies.html">Specifying attribute hierarchies</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dcm/dcmstan/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to dcmstan</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-dcm/dcmstan/blob/main/vignettes/dcmstan.Rmd" class="external-link"><code>vignettes/dcmstan.Rmd</code></a></small>
      <div class="d-none name"><code>dcmstan.Rmd</code></div>
    </div>

    
    
<p>dcmstan is an R package that generates the <a href="https://mc-stan.org" class="external-link"><em>Stan</em></a> code needed for estimating
diagnostic classification models (DCMs; also known as cognitive
diagnostic models [CDMs]). dcmstan provides functionality for all major
DCMs that are used in practice and supports the specification of both
measurement and structural models. Here, you’ll find a brief overview of
how to specify a diagnostic model and generate the associated
<em>Stan</em> code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcmstan.r-dcm.org">dcmstan</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="specifying-a-dcm">Specifying a DCM<a class="anchor" aria-label="anchor" href="#specifying-a-dcm"></a>
</h2>
<p>We create a specification using <code><a href="../reference/dcm_specify.html">dcm_specify()</a></code>. First, we
must define our Q-matrix, which represents how the assessment items
relate to the latent attributes. For this example, we’ll create a
specification for the simulated “Diagnostic Teachers’ Multiplicative
Reasoning” (DTMR) data. In the DTMR data, there are 27 items that
collectively measure 4 attributes (for more information see
<code><a href="https://dcmdata.r-dcm.org/reference/dtmr.html" class="external-link">?dcmdata::dtmr</a></code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcmdata.r-dcm.org" class="external-link">dcmdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dtmr_qmatrix</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 27 × 5</span></span></span>
<span><span class="co">#&gt;    item  referent_units partitioning_iterating appropriateness</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1                  1                      0               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2                  0                      0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3                  0                      1               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4                  1                      0               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5                  1                      0               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6                  0                      1               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7                  1                      0               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8a                 0                      0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 8b                 0                      0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 8c                 0                      0               1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: multiplicative_comparison &lt;dbl&gt;</span></span></span></code></pre></div>
<p>In the Q-matrix, a <code>1</code> indicates that the attribute (in
the columns) is measured by a given item (in the rows). Our Q-matrix
also includes an item identifier with the item names or identifiers. We
pass the Q-matrix and the (optional) identifier to
<code><a href="../reference/dcm_specify.html">dcm_specify()</a></code>. We can then specify our chosen measurement
and structural models. Here, we keep the default
<code><a href="../reference/structural-model.html">unconstrained()</a></code> structural model but overwrite the default
<code><a href="../reference/measurement-model.html">lcdm()</a></code> measurement model to specify a <code><a href="../reference/measurement-model.html">dina()</a></code>
model. These options are described in more detail in the following
sections.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dcm_specify.html">dcm_specify</a></span><span class="op">(</span></span>
<span>  qmatrix <span class="op">=</span> <span class="va">dtmr_qmatrix</span>,</span>
<span>  identifier <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>  measurement_model <span class="op">=</span> <span class="fu"><a href="../reference/measurement-model.html">dina</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  structural_model <span class="op">=</span> <span class="fu"><a href="../reference/structural-model.html">bayesnet</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span></span>
<span><span class="co">#&gt; A deterministic input, noisy "and" gate (DINA) model measuring 4</span></span>
<span><span class="co">#&gt; attributes with 27 items.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Attributes:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #0000BB;">"referent_units"</span> (15 items)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #0000BB;">"partitioning_iterating"</span> (10 items)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #0000BB;">"appropriateness"</span> (5 items)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #0000BB;">"multiplicative_comparison"</span> (5 items)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Attribute structure:</span></span>
<span><span class="co">#&gt;   Bayesian network,</span></span>
<span><span class="co">#&gt;   with structure:</span></span>
<span><span class="co">#&gt;   referent_units -&gt; partitioning_iterating referent_units -&gt;</span></span>
<span><span class="co">#&gt;   appropriateness referent_units -&gt; multiplicative_comparison</span></span>
<span><span class="co">#&gt;   partitioning_iterating -&gt; appropriateness partitioning_iterating -&gt;</span></span>
<span><span class="co">#&gt;   multiplicative_comparison appropriateness -&gt; multiplicative_comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Prior distributions:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">slip</span> ~ beta(5, 25)</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">guess</span> ~ beta(5, 25)</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">structural_intercept</span> ~ normal(0, 2)</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">structural_maineffect</span> ~ lognormal(0, 1)</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">structural_interaction</span> ~ normal(0, 2)</span></span></code></pre></div>
<div class="section level3">
<h3 id="measurement-models">Measurement models<a class="anchor" aria-label="anchor" href="#measurement-models"></a>
</h3>
<p>The measurement model defines how attributes relate to the items. For
example, take item 10b in the DTMR Q-matrix, which measures both
Referent Units and Multiplicative Comparison. Does a respondent need to
be proficient on both attributes in order to answer the item correct?
Just one of the attributes? Or maybe proficiency on one of the
attributes makes it more likely the respondent will provide a correct
response, but not as likely as if they were proficient on both?</p>
<p>These relationships are determined by the measurement model. dcmstan
supports several measurement models that each make different assumptions
about how items relate to the measured attributes. Specifically, we
support the six core DCMs identified by <span class="citation">(<a href="#ref-rupp-dcm">Rupp et al., 2010</a>)</span>, as well as the
general loglinear cognitive diagnostic model <span class="citation">(LCDM; <a href="#ref-lcdm">Henson et al., 2009</a>; <a href="#ref-lcdm-handbook">Henson &amp; Templin, 2019</a>)</span> which
subsumes the more restrictive core DCMs. For more information on each
measurement model, see <code><a href="../reference/measurement-model.html">?`measurement-model`</a></code> and the
accompanying references.</p>
<table style="width:100%;" class="table">
<caption>Supported measurement models</caption>
<colgroup>
<col width="36%">
<col width="18%">
<col width="30%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">Abbreviation</th>
<th align="center">Reference</th>
<th align="center">dcmstan</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Loglinear cognitive diagnostic model</td>
<td align="center">LCDM</td>
<td align="center"><span class="citation">Henson et al. (<a href="#ref-lcdm">2009</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">lcdm()</a></code></td>
</tr>
<tr class="even">
<td align="left">Deterministic input, noisy “and” gate</td>
<td align="center">DINA</td>
<td align="center"><span class="citation">de la Torre &amp; Douglas (<a href="#ref-dina">2004</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">dina()</a></code></td>
</tr>
<tr class="odd">
<td align="left">Deterministic input, noisy “or” gate</td>
<td align="center">DINO</td>
<td align="center"><span class="citation">Templin &amp; Henson (<a href="#ref-dino">2006</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">dino()</a></code></td>
</tr>
<tr class="even">
<td align="left">Noisy-input, deterministic “and” gate</td>
<td align="center">NIDA</td>
<td align="center"><span class="citation">Junker &amp; Sijtsma (<a href="#ref-nida">2001</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">nida()</a></code></td>
</tr>
<tr class="odd">
<td align="left">Noisy-input, deterministic “or” gate</td>
<td align="center">NIDO</td>
<td align="center"><span class="citation">Templin (<a href="#ref-nido">2006</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">nido()</a></code></td>
</tr>
<tr class="even">
<td align="left">Noncompensatory reparameterized unified model</td>
<td align="center">NC-RUM</td>
<td align="center"><span class="citation">DiBello et al. (<a href="#ref-ncrum">1995</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">ncrum()</a></code></td>
</tr>
<tr class="odd">
<td align="left">Compensatory reparameterized unified model</td>
<td align="center">C-RUM</td>
<td align="center"><span class="citation">Hartz (<a href="#ref-crum">2002</a>)</span></td>
<td align="center"><code><a href="../reference/measurement-model.html">crum()</a></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="structural-models">Structural models<a class="anchor" aria-label="anchor" href="#structural-models"></a>
</h3>
<p>Whereas the measurement model defines how the attributes relate to
the items, the structural model defines how the attributes relate to
each other. For example, it could be that the attributes following a
specific ordering or hierarchy, such as a learning progression, where a
respondent must be proficient on one attribute prior to gaining
proficiency on another. Or perhaps the proficiency statuses of different
attributes are completely independent.</p>
<p>The inter-attribute relationships are defined by the structural
model. dcmstan supports several structural models that each allow for
different specifications for how the attributes relate to each other.
Specifically, we support a range of interrelatedness from unconstrained
to fully independent attributes with the unconstrained, independent, and
loglinear models. We also support the specification of specific
relationships and hierarchies through the hierarchical diagnostic
classification model and Bayesian network structural models. For more
information on each structural model, see
<code><a href="../reference/structural-model.html">?`structural-model`</a></code> and the accompanying references.</p>
<table style="width:100%;" class="table">
<caption>Supported structural models</caption>
<colgroup>
<col width="36%">
<col width="18%">
<col width="30%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">Abbreviation</th>
<th align="center">Reference</th>
<th align="center">dcmstan</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Unconstrained</td>
<td align="center"></td>
<td align="center"><span class="citation">Rupp et al. (<a href="#ref-rupp-dcm">2010</a>)</span></td>
<td align="center"><code><a href="../reference/structural-model.html">unconstrained()</a></code></td>
</tr>
<tr class="even">
<td align="left">Independent</td>
<td align="center"></td>
<td align="center"><span class="citation">Lee (<a href="#ref-independent">2017</a>)</span></td>
<td align="center"><code><a href="../reference/structural-model.html">independent()</a></code></td>
</tr>
<tr class="odd">
<td align="left">Loglinear</td>
<td align="center"></td>
<td align="center"><span class="citation">Xu &amp; von Davier (<a href="#ref-loglinear">2008</a>)</span></td>
<td align="center"><code><a href="../reference/structural-model.html">loglinear()</a></code></td>
</tr>
<tr class="even">
<td align="left">Hierarchical DCM</td>
<td align="center">HDCM</td>
<td align="center"><span class="citation">Templin &amp; Bradshaw (<a href="#ref-hdcm">2014</a>)</span></td>
<td align="center"><code><a href="../reference/structural-model.html">hdcm()</a></code></td>
</tr>
<tr class="odd">
<td align="left">Bayesian network</td>
<td align="center">BN</td>
<td align="center"><span class="citation">Hu &amp; Templin (<a href="#ref-bayesnet">2020</a>)</span></td>
<td align="center"><code><a href="../reference/structural-model.html">bayesnet()</a></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="from-specification-to-estimation">From specification to estimation<a class="anchor" aria-label="anchor" href="#from-specification-to-estimation"></a>
</h2>
<p>Once we have specified a model, we can create the necessary
<em>Stan</em> code using <code><a href="../reference/stan_code.html">stan_code()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stan_code.html">stan_code</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; data {</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; I;                      // number of items</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; R;                      // number of respondents</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; N;                      // number of observations</span></span>
<span><span class="co">#&gt;   int&lt;lower=1&gt; C;                      // number of classes</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=1,upper=I&gt; ii;    // item for observation n</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=1,upper=R&gt; rr;    // respondent for observation n</span></span>
<span><span class="co">#&gt;   array[N] int&lt;lower=0,upper=1&gt; y;     // score for observation n</span></span>
<span><span class="co">#&gt;   array[R] int&lt;lower=1,upper=N&gt; start; // starting row for respondent R</span></span>
<span><span class="co">#&gt;   array[R] int&lt;lower=1,upper=I&gt; num;   // number items for respondent R</span></span>
<span><span class="co">#&gt;   matrix[I,C] Xi;                      // class attribute indicator</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; parameters {</span></span>
<span><span class="co">#&gt;   ////////////////////////////////// structural intercepts</span></span>
<span><span class="co">#&gt;   real g1_0;</span></span>
<span><span class="co">#&gt;   real g2_0;</span></span>
<span><span class="co">#&gt;   real g3_0;</span></span>
<span><span class="co">#&gt;   real g4_0;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// structural main effects</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g2_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g3_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g4_11;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g3_12;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g4_12;</span></span>
<span><span class="co">#&gt;   real&lt;lower=0&gt; g4_13;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// structural interactions</span></span>
<span><span class="co">#&gt;   real&lt;lower=-1 * min([g3_11,g3_12])&gt; g3_212;</span></span>
<span><span class="co">#&gt;   real&lt;lower=-1 * min([g4_11,g4_12])&gt; g4_212;</span></span>
<span><span class="co">#&gt;   real&lt;lower=-1 * min([g4_11,g4_13])&gt; g4_213;</span></span>
<span><span class="co">#&gt;   real&lt;lower=-1 * min([g4_12,g4_13])&gt; g4_223;</span></span>
<span><span class="co">#&gt;   real&lt;lower=-1 * min([g4_11+g4_212+g4_213,g4_12+g4_212+g4_223,g4_13+g4_213+g4_223])&gt; g4_3123;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// item parameters</span></span>
<span><span class="co">#&gt;   array[I] real&lt;lower=0,upper=1&gt; slip;</span></span>
<span><span class="co">#&gt;   array[I] real&lt;lower=0,upper=1&gt; guess;</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; transformed parameters {</span></span>
<span><span class="co">#&gt;   simplex[C] Vc;</span></span>
<span><span class="co">#&gt;   vector[C] log_Vc;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// class membership probabilities</span></span>
<span><span class="co">#&gt;   Vc[1] = (1 - inv_logit(g1_0)) * (1 - inv_logit(g2_0)) * (1 - inv_logit(g3_0)) * (1 - inv_logit(g4_0));</span></span>
<span><span class="co">#&gt;   Vc[2] = inv_logit(g1_0) * (1 - inv_logit(g2_0 + g2_11)) * (1 - inv_logit(g3_0 + g3_11)) * (1 - inv_logit(g4_0 + g4_11));</span></span>
<span><span class="co">#&gt;   Vc[3] = (1 - inv_logit(g1_0)) * inv_logit(g2_0) * (1 - inv_logit(g3_0 + g3_12)) * (1 - inv_logit(g4_0 + g4_12));</span></span>
<span><span class="co">#&gt;   Vc[4] = (1 - inv_logit(g1_0)) * (1 - inv_logit(g2_0)) * inv_logit(g3_0) * (1 - inv_logit(g4_0 + g4_13));</span></span>
<span><span class="co">#&gt;   Vc[5] = (1 - inv_logit(g1_0)) * (1 - inv_logit(g2_0)) * (1 - inv_logit(g3_0)) * inv_logit(g4_0);</span></span>
<span><span class="co">#&gt;   Vc[6] = inv_logit(g1_0) * inv_logit(g2_0 + g2_11) * (1 - inv_logit(g3_0 + g3_11 + g3_12 + g3_212)) * (1 - inv_logit(g4_0 + g4_11 + g4_12 + g4_212));</span></span>
<span><span class="co">#&gt;   Vc[7] = inv_logit(g1_0) * (1 - inv_logit(g2_0 + g2_11)) * inv_logit(g3_0 + g3_11) * (1 - inv_logit(g4_0 + g4_11 + g4_13 + g4_213));</span></span>
<span><span class="co">#&gt;   Vc[8] = inv_logit(g1_0) * (1 - inv_logit(g2_0 + g2_11)) * (1 - inv_logit(g3_0 + g3_11)) * inv_logit(g4_0 + g4_11);</span></span>
<span><span class="co">#&gt;   Vc[9] = (1 - inv_logit(g1_0)) * inv_logit(g2_0) * inv_logit(g3_0 + g3_12) * (1 - inv_logit(g4_0 + g4_12 + g4_13 + g4_223));</span></span>
<span><span class="co">#&gt;   Vc[10] = (1 - inv_logit(g1_0)) * inv_logit(g2_0) * (1 - inv_logit(g3_0 + g3_12)) * inv_logit(g4_0 + g4_12);</span></span>
<span><span class="co">#&gt;   Vc[11] = (1 - inv_logit(g1_0)) * (1 - inv_logit(g2_0)) * inv_logit(g3_0) * inv_logit(g4_0 + g4_13);</span></span>
<span><span class="co">#&gt;   Vc[12] = inv_logit(g1_0) * inv_logit(g2_0 + g2_11) * inv_logit(g3_0 + g3_11 + g3_12 + g3_212) * (1 - inv_logit(g4_0 + g4_11 + g4_12 + g4_13 + g4_212 + g4_213 + g4_223 + g4_3123));</span></span>
<span><span class="co">#&gt;   Vc[13] = inv_logit(g1_0) * inv_logit(g2_0 + g2_11) * (1 - inv_logit(g3_0 + g3_11 + g3_12 + g3_212)) * inv_logit(g4_0 + g4_11 + g4_12 + g4_212);</span></span>
<span><span class="co">#&gt;   Vc[14] = inv_logit(g1_0) * (1 - inv_logit(g2_0 + g2_11)) * inv_logit(g3_0 + g3_11) * inv_logit(g4_0 + g4_11 + g4_13 + g4_213);</span></span>
<span><span class="co">#&gt;   Vc[15] = (1 - inv_logit(g1_0)) * inv_logit(g2_0) * inv_logit(g3_0 + g3_12) * inv_logit(g4_0 + g4_12 + g4_13 + g4_223);</span></span>
<span><span class="co">#&gt;   Vc[16] = inv_logit(g1_0) * inv_logit(g2_0 + g2_11) * inv_logit(g3_0 + g3_11 + g3_12 + g3_212) * inv_logit(g4_0 + g4_11 + g4_12 + g4_13 + g4_212 + g4_213 + g4_223 + g4_3123);</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   log_Vc = log(Vc);</span></span>
<span><span class="co">#&gt;   matrix[I,C] pi;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   for (i in 1:I) {</span></span>
<span><span class="co">#&gt;     for (c in 1:C) {</span></span>
<span><span class="co">#&gt;       pi[i,c] = ((1 - slip[i]) ^ Xi[i,c]) * (guess[i] ^ (1 - Xi[i,c]));</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; model {</span></span>
<span><span class="co">#&gt;   ////////////////////////////////// priors</span></span>
<span><span class="co">#&gt;   g1_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g2_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g3_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g4_0 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g2_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g3_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g4_11 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g3_12 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g4_12 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g4_13 ~ lognormal(0, 1);</span></span>
<span><span class="co">#&gt;   g3_212 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g4_212 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g4_213 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g4_223 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   g4_3123 ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;   slip[1] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[1] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[2] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[2] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[3] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[3] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[4] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[4] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[5] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[5] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[6] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[6] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[7] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[7] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[8] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[8] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[9] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[9] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[10] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[10] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[11] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[11] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[12] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[12] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[13] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[13] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[14] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[14] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[15] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[15] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[16] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[16] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[17] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[17] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[18] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[18] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[19] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[19] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[20] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[20] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[21] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[21] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[22] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[22] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[23] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[23] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[24] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[24] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[25] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[25] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[26] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[26] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   slip[27] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt;   guess[27] ~ beta(5, 25);</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ////////////////////////////////// likelihood</span></span>
<span><span class="co">#&gt;   for (r in 1:R) {</span></span>
<span><span class="co">#&gt;     row_vector[C] ps;</span></span>
<span><span class="co">#&gt;     for (c in 1:C) {</span></span>
<span><span class="co">#&gt;       array[num[r]] real log_items;</span></span>
<span><span class="co">#&gt;       for (m in 1:num[r]) {</span></span>
<span><span class="co">#&gt;         int i = ii[start[r] + m - 1];</span></span>
<span><span class="co">#&gt;         log_items[m] = y[start[r] + m - 1] * log(pi[i,c]) +</span></span>
<span><span class="co">#&gt;                        (1 - y[start[r] + m - 1]) * log(1 - pi[i,c]);</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;       ps[c] = log_Vc[c] + sum(log_items);</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     target += log_sum_exp(ps);</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This provides the code need for <code>rstan::stan()</code> to
estimate the model. You can either pass the code directly to the
<code>model_code</code> argument, or save the code to a file, customize
it as needed, and then provide the file path to the modified code to the
<code>file</code> argument (see <code>?rstan::stan</code> for additional
guidance).</p>
<p>You will also need to create a list of data objects for
<em>Stan</em>. This can be accomplished using <code><a href="../reference/stan_data.html">stan_data()</a></code>.
This function takes our data set and the respondent identifier column
name (can be excluded if not present in <code>data</code>), and provides
a list that can be supplied to the <code>data</code> argument of
<code>rstan::stan()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtmr_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 990 × 28</span></span></span>
<span><span class="co">#&gt;    id      `1`   `2`   `3`   `4`   `5`   `6`   `7`  `8a`  `8b`  `8c`  `8d`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0008…     1     1     0     1     0     0     1     1     0     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0009…     0     1     0     0     0     0     0     1     1     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0024…     0     1     0     0     0     0     1     1     1     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0031…     0     1     0     0     1     0     1     1     1     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0061…     0     1     1     0     0     0     0     0     0     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0087…     0     1     1     1     0     0     0     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0092…     0     1     1     1     1     0     0     1     1     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0097…     0     0     0     1     0     0     0     1     0     1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0111…     0     1     1     0     0     0     0     1     0     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0121…     0     1     0     0     0     0     0     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 980 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 16 more variables: `9` &lt;int&gt;, `10a` &lt;int&gt;, `10b` &lt;int&gt;, `10c` &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `11` &lt;int&gt;, `12` &lt;int&gt;, `13` &lt;int&gt;, `14` &lt;int&gt;, `15a` &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `15b` &lt;int&gt;, `15c` &lt;int&gt;, `16` &lt;int&gt;, `17` &lt;int&gt;, `18` &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `21` &lt;int&gt;, `22` &lt;int&gt;</span></span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_data.html">stan_data</a></span><span class="op">(</span><span class="va">spec</span>, data <span class="op">=</span> <span class="va">dtmr_data</span>, identifier <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ I    : int 27</span></span>
<span><span class="co">#&gt;  $ R    : int 990</span></span>
<span><span class="co">#&gt;  $ N    : int 26730</span></span>
<span><span class="co">#&gt;  $ C    : int 16</span></span>
<span><span class="co">#&gt;  $ ii   : num [1:26730] 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ rr   : num [1:26730] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ y    : int [1:26730] 1 1 0 1 0 0 1 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ start: int [1:990] 1 28 55 82 109 136 163 190 217 244 ...</span></span>
<span><span class="co">#&gt;  $ num  : int [1:990] 27 27 27 27 27 27 27 27 27 27 ...</span></span>
<span><span class="co">#&gt;  $ Xi   : num [1:27, 1:16] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>Note that the elements of the data list correspond to the variables
that are declared in the <code>data</code> block of the code generated
with <code><a href="../reference/stan_code.html">stan_code()</a></code>. If you customize the <em>Stan</em> code
and include additional data variables, you will need to also add the
corresponding data objects to the list.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-dina" class="csl-entry">
de la Torre, J., &amp; Douglas, J. A. (2004). Higher-order latent trait
models for cognitive diagnosis. <em>Psychometrika</em>, <em>69</em>(3),
333–353. <a href="https://doi.org/10.1007/BF02295640" class="external-link">https://doi.org/10.1007/BF02295640</a>
</div>
<div id="ref-ncrum" class="csl-entry">
DiBello, L. V., Stout, W. F., &amp; Roussos, L. (1995). Unified
cognitive psychometric assessment likelihood-based classification
techniques. In P. D. Nichols, S. F. Chipman, &amp; R. L. Brennan (Eds.),
<em>Cognitively diagnostic assessment</em> (pp. 361–390). Erlbaum.
</div>
<div id="ref-crum" class="csl-entry">
Hartz, S. M. (2002). <em>A <span>Bayesian</span> framework for the
unified model for assessing cognitive abilities: <span>Blending</span>
theory with practicality</em> (Publication No. 3044108). <span>[Doctoral
thesis, University of Illinois at Urbana-Champaign]. ProQuest
Dissertations and Theses Global</span>.
</div>
<div id="ref-lcdm-handbook" class="csl-entry">
Henson, R., &amp; Templin, J. (2019). Loglinear cognitive diagnostic
model (<span>LCDM</span>). In M. von Davier &amp; Y.-S. Lee (Eds.),
<em>Handbook of <span>Diagnostic Classification Models</span></em> (pp.
171–185). <span>Springer International Publishing</span>. <a href="https://doi.org/10.1007/978-3-030-05584-4_8" class="external-link">https://doi.org/10.1007/978-3-030-05584-4_8</a>
</div>
<div id="ref-lcdm" class="csl-entry">
Henson, R., Templin, J., &amp; Willse, J. T. (2009). Defining a family
of cognitive diagnosis models using log-linear models with latent
variables. <em>Psychometrika</em>, <em>74</em>(2), 191–210. <a href="https://doi.org/10.1007/s11336-008-9089-5" class="external-link">https://doi.org/10.1007/s11336-008-9089-5</a>
</div>
<div id="ref-bayesnet" class="csl-entry">
Hu, B., &amp; Templin, J. (2020). Using diagnostic classification models
to validate attribute hierarchies and evaluate model fit in
<span>Bayesian</span> networks. <em>Multivariate Behavioral
Research</em>, <em>55</em>(2), 300–311. <a href="https://doi.org/10.1080/00273171.2019.1632165" class="external-link">https://doi.org/10.1080/00273171.2019.1632165</a>
</div>
<div id="ref-nida" class="csl-entry">
Junker, B. W., &amp; Sijtsma, K. (2001). Cognitive assessment models
with few assumptions, and connections with nonparametric item response
theory. <em>Applied Psychological Measurement</em>, <em>25</em>(3),
258–272. <a href="https://doi.org/10.1177/01466210122032064" class="external-link">https://doi.org/10.1177/01466210122032064</a>
</div>
<div id="ref-independent" class="csl-entry">
Lee, S. Y. (2017, June 27). <em>Cognitive diagnosis model:
<span>DINA</span> model with independent attributes</em>. Stan. <a href="https://mc-stan.org/learn-stan/case-studies/dina_independent.html" class="external-link">https://mc-stan.org/learn-stan/case-studies/dina_independent.html</a>
</div>
<div id="ref-rupp-dcm" class="csl-entry">
Rupp, A. A., Templin, J., &amp; Henson, R. A. (2010). <em>Diagnostic
measurement: <span>Theory</span>, methods, and applications</em>.
<span>Guilford Press</span>.
</div>
<div id="ref-nido" class="csl-entry">
Templin, J. (2006). <em><span>CDM</span> user’s guide</em> [Unpublished
manuscript]. Department of Psychology, University of Kansas.
</div>
<div id="ref-hdcm" class="csl-entry">
Templin, J., &amp; Bradshaw, L. (2014). Hierarchical diagnostic
classification models: <span>A</span> family of models for estimating
and testing attribute hierarchies. <em>Psychometrika</em>,
<em>79</em>(2), 317–339. <a href="https://doi.org/10.1007/s11336-013-9362-0" class="external-link">https://doi.org/10.1007/s11336-013-9362-0</a>
</div>
<div id="ref-dino" class="csl-entry">
Templin, J., &amp; Henson, R. A. (2006). Measurement of psychological
disorders using cognitive diagnosis models. <em>Psychological
Methods</em>, <em>11</em>(3), 287–305. <a href="https://doi.org/10.1037/1082-989X.11.3.287" class="external-link">https://doi.org/10.1037/1082-989X.11.3.287</a>
</div>
<div id="ref-loglinear" class="csl-entry">
Xu, X., &amp; von Davier, M. (2008). <em>Fitting the structured general
diagnostic model to <span>NAEP</span> data</em> (RR-08-27). Educational
Testing Service. <a href="https://files.eric.ed.gov/fulltext/EJ1111272.pdf" class="external-link">https://files.eric.ed.gov/fulltext/EJ1111272.pdf</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://wjakethompson.com" class="external-link">W. Jake Thompson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
